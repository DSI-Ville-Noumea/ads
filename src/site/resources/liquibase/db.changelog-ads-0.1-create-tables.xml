<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet author="rayni84" id="74682a70-41d5-11e3-aa6e-0800200c9a66-1">
        <createSequence
            cycle="false"
            incrementBy="1"
            minValue="0"
            sequenceName="ads_s_revision"
            startValue="0"/>
            
        <createTable tableName="ads_revision">
            <column name="id_revision" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="id_agent" type="INT4">
                <constraints nullable="false"/>
            </column>
            <column name="date_modif" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="date_effet" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="date_decret" type="DATE">
                <constraints nullable="true"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="true"/>
            </column>
            <column name="version" type="INT4">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addPrimaryKey columnNames="id_revision" constraintName="pk_ads_revision" tableName="ads_revision"/>
        <addDefaultValue tableName="ads_revision" columnName="id_revision" defaultValueSequenceNext="ads_s_revision" />
    </changeSet>
    
    <changeSet author="rayni84" id="74682a70-41d5-11e3-aa6e-0800200c9a66-2">
        <createSequence
            cycle="false"
            incrementBy="1"
            minValue="0"
            sequenceName="ads_s_noeud"
            startValue="0"/>
            
        <createSequence
            cycle="false"
            incrementBy="1"
            minValue="0"
            sequenceName="ads_s_noeud_service"
            startValue="0"/>
            
        <createTable tableName="ads_noeud">
            <column name="id_noeud" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="id_service" type="INT4">
                <constraints nullable="false"/>
            </column>
            <column name="sigle" type="NVARCHAR2(25)">
                <constraints nullable="false"/>
            </column>
            <column name="label" type="NVARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="id_revision" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="id_noeud_parent" type="INT8">
                <constraints nullable="true"/>
            </column>
            <column name="version" type="INT4">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addPrimaryKey columnNames="id_noeud" constraintName="pk_ads_noeud" tableName="ads_noeud"/>
        
        <addDefaultValue tableName="ads_noeud" columnName="id_noeud" defaultValueSequenceNext="ads_s_noeud" />

        <addDefaultValue tableName="ads_noeud" columnName="id_service" defaultValueSequenceNext="ads_s_noeud_service" />
        
        <addForeignKeyConstraint 
            constraintName="fk_ads_noeud_ads_revision"
            baseColumnNames="id_revision" baseTableName="ads_noeud" 
            referencedColumnNames="id_revision" referencedTableName="ads_revision"/>
            
        <addForeignKeyConstraint 
            constraintName="fk_ads_noeud_parent_ads_noeud"
            baseColumnNames="id_noeud_parent" baseTableName="ads_noeud" 
            referencedColumnNames="id_noeud" referencedTableName="ads_noeud"/>
            
        <addUniqueConstraint columnNames="id_service, id_revision"
            constraintName="uq_id_service_id_revision" tableName="ads_noeud"/>
            
    </changeSet>
    
    <changeSet author="rayni84" id="74682a70-41d5-11e3-aa6e-0800200c9a66-3">
        <createSequence
            cycle="false"
            incrementBy="1"
            minValue="0"
            sequenceName="ads_s_siserv_info"
            startValue="0"/>
            
        <createTable tableName="ads_siserv_info">
            <column name="id_siserv_info" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="id_noeud" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="code_servi" type="NVARCHAR2(10)">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT4">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addPrimaryKey columnNames="id_siserv_info" constraintName="pk_ads_siserv_info" tableName="ads_siserv_info"/>
        
        <addDefaultValue tableName="ads_siserv_info" columnName="id_siserv_info" defaultValueSequenceNext="ads_s_siserv_info" />

        <addForeignKeyConstraint 
            constraintName="fk_ads_noeud_parent_ads_noeud"
            baseColumnNames="id_noeud" baseTableName="ads_siserv_info" 
            referencedColumnNames="id_noeud" referencedTableName="ads_noeud"/>
            
    </changeSet>
    

</databaseChangeLog>
